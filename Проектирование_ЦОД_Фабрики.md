Попробуйте выполнить самостоятельно.

---

### **Практическая работа №2**
**Тема:** «Проектирование и моделирование сетевой фабрики ЦОД на основе технологий КСПД»

**Цель работы:** Освоить принципы проектирования сетевой инфраструктуры ЦОД в виде единой фабрики (Fabric) с использованием технологий КСПД. Получить практические навыки выбора технологий, проектирования логической и физической топологии, а также базовой конфигурации.

**Используемое ПО:** *Для выполнения работы можно использовать графические редакторы (draw.io, Visio) и/или симуляторы (Cisco Modeling Labs, GNS3, Eve-NG). В данной работе представлен подход, не требующий специализированного ПО.*

---

### **Теоретическая часть (Краткий обзор)**

**1. Понятие Сетевой Фабрики (Network Fabric)**
Это архитектура, где сетевые компоненты (коммутаторы, маршрутизаторы) работают как единая, логически объединенная система, а не как набор разрозненных устройств. Ключевые свойства:
*   **Единое управление:** Управление всей сетью из одной точки.
*   **Горизонтальная масштабируемость:** Легкое добавление новых узлов без сложных изменений.
*   **Высокая отказоустойчивость:** Отсутствие единых точек отказа (Single Point of Failure - SPoF).
*   **Любой-к-любому (Any-to-Any):** Минимальная и предсказуемая задержка между любыми точками сети.

**2. Технологии КСПД для построения фабрик**
КСПД объединяет вычислительные ресурсы, сети хранения данных и сети передачи данных в единую инфраструктуру. Для построения фабрик используются:

*   **Underlay-сеть:** Физическая и IP-сеть, обеспечивающая базовую связность. Часто строится на протоколе **BGP** (для простоты, масштабируемости и поддержки ECMP).
*   **Overlay-сеть:** Виртуальная сеть, туннелируемая через Underlay. Технологии: **VXLAN** (для создания изолированных L2-доменов поверх L3-сети), **EVPN** (протокол управления рассылкой MAC-адресов для VXLAN, заменяющий традиционный STP).
*   **Технологии доступа к среде:** **Ethernet**, **Fibre Channel** (FC), **Fibre Channel over Ethernet (FCoE)**.

---

### **Практическая часть**

#### **Задание 1: Разработка требований и выбор архитектуры**

**Сценарий:** Необходимо спроектировать сетевую фабрику для нового ЦОД коммерческой компании. Требования:

1.  **Вычислительная мощность:** 4 стоечных сервера.
2.  **Сети:**
    *   Сеть передачи данных (Data Network): Требуется создать 3 изолированных VLAN/L2-домена (Frontend, Backend, Management).
    *   Сеть хранения данных (Storage Network): Необходимо обеспечить подключение к системе хранения по IP (iSCSI). Требуется высокая производительность и низкая задержка.
3.  **Отказоустойчивость:** Отсутствие SPoF на всех уровнях.
4.  **Масштабируемость:** Возможность добавления еще 4 стоек в будущем без кардинального изменения архитектуры.

**Вопросы и решение:**

*   **1.1. Какую базовую топологию Underlay-сети вы выберете?**
    *   *Варианты: "Clos Fabric" (Leaf-and-Spine), "Full-Mesh".*
    *   **Ответ:** Выбираем архитектуру **Leaf-and-Spine**. Она идеально соответствует требованиям масштабируемости и отказоустойчивости. Каждый Leaf-коммутатор подключен к каждому Spine-коммутатору.

*   **1.2. Какие технологии Overlay вы будете использовать и почему?**
    *   **Ответ:** **VXLAN + EVPN**. VXLAN позволит создать 3 требуемых изолированных L2-домена поверх IP-сети Underlay. EVPN будет использоваться как протокол контроля для эффективного распространения MAC- и IP-маршрутов, обеспечивая оптимальный маршрутизацию трафика (Anycast Gateway) и отказоустойчивость.

*   **1.3. Как будет организована сеть хранения данных?**
    *   **Ответ:** Для iSCSI будем использовать выделенные VLAN в рамках той же фабрики. Это преимущество КСПД — конвергенция трафика. Для обеспечения отказоустойчивости и производительности каждый сервер будет иметь 2 сетевых подключения (Multi-Path I/O - MPIO) к разным Leaf-коммутаторам.

---

#### **Задание 2: Проектирование логической схемы (Top-Down Design)**

**2.1. Спроектируйте Underlay-сеть:**

*   **Устройства:**
    *   Spine-коммутаторы: 2 шт. (для устранения SPoF).
    *   Leaf-коммутаторы: 2 шт. (каждый сервер подключен к обоим Leaf-ам для отказоустойчивости).
    *   Серверы: 4 шт. (по 2 сетевых интерфейса на каждый, подключенных к разным Leaf).
*   **Адресация Underlay (пример):**
    *   Используем сеть `172.16.0.0/16`.
    *   Point-to-Point линки между Spine и Leaf: `172.16.1.0/31`, `172.16.1.2/31` и т.д.
    *   Loopback-интерфейсы коммутаторов (важны для BGP и Overlay): `172.16.255.1/32` (Spine-1), `172.16.255.2/32` (Spine-2), `172.16.255.11/32` (Leaf-1), `172.16.255.12/32` (Leaf-2).
*   **Протокол маршрутизации:** BGP.

**Задание:** Нарисуйте схему Underlay-сети, указав IP-адреса на всех интерфейсах.
*(Пример в draw.io/Visio: Сверху 2 блока "Spine", снизу 2 блока "Leaf", между ними перекрестные связи. Снизу от Leaf-ов - серверы).*

**2.2. Спроектируйте Overlay-сеть (VXLAN):**

*   **VNI (VXLAN Network Identifier):** Присвойте идентификаторы для каждого VLAN.
    *   VNI 10010 - Management (VLAN 10)
    *   VNI 10020 - Frontend (VLAN 20)
    *   VNI 10030 - Backend (VLAN 30)
    *   VNI 10040 - Storage-iSCSI (VLAN 40)
*   **Anycast Gateway:** На обоих Leaf-коммутаторах для каждого VNI будет настроен один и тот же IP-адрес шлюза по умолчанию. Это позволяет серверу сохранять связность при отказе одного из Leaf.

**Задание:** Создайте таблицу соответствия:

| Назначение сети | VLAN ID | VNI      | Anycast Gateway IP |
|-----------------|---------|----------|--------------------|
| Management      | 10      | 10010    | 10.10.10.1/24      |
| Frontend        | 20      | 10020    | 10.10.20.1/24      |
| Backend         | 30      | 10030    | 10.10.30.1/24      |
| Storage (iSCSI) | 40      | 10040    | 10.10.40.1/24      |

---

#### **Задание 3: Моделирование базовой конфигурации устройства**

**3.1. Конфигурация Underlay (на примере Leaf-1):**

*(Это упрощенный пример для Cisco NX-OS стиля)*

```
! Базовая настройка
hostname LEAF-1

! Настройка интерфейсов до Spine (Underlay)
interface Ethernet1/1
  description to-SPINE-1
  no switchport
  ip address 172.16.1.0/31
  no shutdown

interface Ethernet1/2
  description to-SPINE-2
  no switchport
  ip address 172.16.1.2/31
  no shutdown

! Настройка интерфейсов до серверов (будет Access/Trunk)
interface Ethernet1/10
  description to-SERVER-1
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40
  no shutdown

! Loopback-интерфейс для BGP и VTEP
interface loopback0
  ip address 172.16.255.11/32

! Настройка BGP
router bgp 65001
  router-id 172.16.255.11
  neighbor 172.16.1.1 remote-as 65000   // SPINE-1
  neighbor 172.16.1.3 remote-as 65000   // SPINE-2
  address-family ipv4 unicast
    network 172.16.255.11/32            // Анонсируем свой Loopback
    neighbor 172.16.1.1 activate
    neighbor 172.16.1.3 activate
```

**3.2. Конфигурация Overlay (на примере Leaf-1):**

```
! Включение функций EVPN
feature nv overlay
feature evpn

! Настройка VXLAN
interface nve1
  source-interface loopback0
  host-reachability protocol evpn

! Создание VLAN и сопоставление с VNI
vlan 10
  name Management
vlan 20
  name Frontend
vlan 30
  name Backend
vlan 40
  name Storage-iSCSI

! Настройка VNI (L2VNI)
interface vlan 10
  no shutdown
  vrf context Management
  ip address 10.10.10.1/24
  fabric forwarding mode anycast-gateway

interface vlan 20
  no shutdown
  vrf context Frontend
  ip address 10.10.20.1/24
  fabric forwarding mode anycast-gateway

! Настройка EVPN для анонсирования маршрутов
router bgp 65001
  address-family l2vpn evpn
    retain route-target all
  template peer EVPN-SPINE
    remote-as 65000
    update-source loopback0
    address-family l2vpn evpn
      send-community extended
  neighbor 172.16.255.1 inherit peer EVPN-SPINE  // SPINE-1 Loopback
  neighbor 172.16.255.2 inherit peer EVPN-SPINE  // SPINE-2 Loopback

! Сопоставление VLAN с VNI
vni 10010 l2
  bridge-domain 10
vni 10020 l2
  bridge-domain 20
```

---

#### **Задание 4: Анализ и тестирование архитектуры**

**Вопросы для самоконтроля:**

1.  **Что произойдет, если один из Spine-коммутаторов выйдет из строя?**
    *   *Ответ:* Трафик автоматически переключится на оставшийся Spine через ECMP в Underlay-сети. Соединения не разорвутся, производительность может незначительно снизиться.

2.  **Как будет маршрутизироваться пакет от сервера в VLAN 20 на Leaf-1 к серверу в VLAN 20 на Leaf-2?**
    *   *Ответ:* Leaf-1 инкапсулирует L2-фрейм в VXLAN-пакет, используя IP-адрес Loopback интерфейса Leaf-2 как получателя. BGP в Underlay-сети направит этот IP-пакет через одного из Spine-коммутаторов. Leaf-2 получит пакет, декапсулирует его и отправит исходный L2-фрейм целевому серверу.

3.  **Как добавить в эту фабрику еще 2 стойки с серверами?**
    *   *Ответ:* Достаточно добавить новые Leaf-коммутаторы, подключить их ко всем существующим Spine-коммутаторам и присвоить им IP-адреса из той же Underlay-сети, а также уникальные Loopback-адреса. Настроить на них BGP-сессии со Spine. Новая инфраструктура автоматически станет частью фабрики.

---

